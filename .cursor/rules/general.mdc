# O1 Pro Flow Development Rules
## Language Models

- **Anthropic:** Exclusively use `claude-3-7-sonnet-20250219` for all tasks requiring Anthropic models. Do not use other versions or models unless explicitly approved.
## Code Structure & Best Practices

- **Framework:** Next.js App Router (v15.3.0) with React (v18.3.1).

- **State Management:** Utilize React Context for global state where appropriate (via `lib/contexts/`). For local state, use React's `useState`.
- **Server Actions:** Place server actions in the `actions/` directory with descriptive names (e.g., `voice-transcription-actions.ts`, `text-improvement-actions.ts`). Ensure they handle errors gracefully.
- **Components:**
    - Reusable UI components in `components/ui/`.
    - Feature-specific components in `app/_components/` (e.g., `generate-prompt/`, `apply-changes/`).
    - Follow React best practices (composition, hooks, forwardRef, displayName).
- **Utilities:** General utility functions in `lib/` with domain-specific utilities in subdirectories:
    - Database operations: `lib/db/` 
    - File operations: `lib/file-utils.ts`, `lib/directory-tree.ts`
    - Path handling: `lib/path-utils.ts`
    - API clients: `lib/anthropic.ts`
- **API Routes:** Implement API routes in `app/api/` using Next.js App Router structure, properly handling errors and returning well-structured responses for database interactions.
- **Database:** Database operations via `lib/db/repository.ts` with setup in `lib/db/setup.ts`.
- **Hooks:** Custom hooks in `hooks/` directory for shared component logic.
- **Styling:** Tailwind CSS via `globals.css` and `tailwind.config.ts`. Use `clsx` and `tailwind-merge` utilities for merging classes.
- **Prompts:** LLM prompts defined in `prompts/` directory (e.g., `refactoring-prompt.ts`, `path-finder-prompt.ts`).
- **Types:** Define shared types in `types/`. Component-specific types defined within component files or `types/` as appropriate.
- **Code Quality:** 
    - Write clean, readable, and maintainable code following SOLID principles where applicable.
    - Follow ESLint rules defined in `.eslintrc.json` and `eslint.config.mjs`.
    - Avoid code duplication; refactor common logic into hooks or utilities.
    - Ensure all code is production-ready: no placeholders, TODOs, or incomplete implementations.
    - Add comments only where necessary to explain complex logic.
- **Package Manager:** Use `pnpm` for dependency management. Ensure `sqlite3` is listed in `pnpm.onlyBuiltDependencies` in `package.json` for correct native addon handling.
- **Error Handling:** For API routes and server actions, use proper error handling with descriptive error messages.
- **Session Management:** Application state (form inputs, file selections) is managed via sessions stored in the database, specific to a project directory and output format. The UI should only allow interaction after a session is created or loaded. Changes within an active session are auto-saved.
## Development Workflow 
 
- Ensure README.md is kept up-to-date with setup instructions and features.
- Follow consistent naming conventions for files and functions throughout the codebase.
- When implementing database operations, use the repository pattern from `lib/db/repository.ts`.
