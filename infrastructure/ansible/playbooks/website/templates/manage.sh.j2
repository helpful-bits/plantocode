#!/bin/bash
# Website Management Script
# Generated by Ansible for {{ domain_name }}

CONTAINER="{{ container_name }}"
DEPLOY_DIR="{{ deployment_dir }}"
PORT="{{ container_port }}"

case "$1" in
    start)
        docker start $CONTAINER
        ;;
    stop)
        docker stop $CONTAINER
        ;;
    restart)
        docker restart $CONTAINER
        ;;
    status)
        docker ps -a --filter name=$CONTAINER --format "table {% raw %}{{.Names}}\t{{.Status}}\t{{.Ports}}{% endraw %}"
        ;;
    logs)
        shift
        docker logs -f $CONTAINER "$@"
        ;;
    rebuild)
        echo "Rebuilding container..."
        docker stop $CONTAINER 2>/dev/null
        docker rm $CONTAINER 2>/dev/null
        docker build -t $CONTAINER:latest $DEPLOY_DIR
        docker run -d \
            --name $CONTAINER \
            --restart unless-stopped \
            -p 127.0.0.1:$PORT:3000 \
            --env-file $DEPLOY_DIR/.env.production \
            -e NODE_ENV=production \
            -e HOSTNAME=0.0.0.0 \
            -e PORT=3000 \
            $CONTAINER:latest
        echo "Container rebuilt and started"
        ;;
    shell)
        docker exec -it $CONTAINER /bin/sh
        ;;
    env)
        echo "Environment variables in container:"
        docker exec $CONTAINER env | sort
        ;;
    *)
        echo "Usage: $0 {start|stop|restart|status|logs|rebuild|shell|env}"
        echo ""
        echo "  start    - Start the container"
        echo "  stop     - Stop the container"
        echo "  restart  - Restart the container"
        echo "  status   - Show container status"
        echo "  logs     - Follow container logs"
        echo "  rebuild  - Rebuild and restart container"
        echo "  shell    - Open shell in container"
        echo "  env      - Show environment variables"
        exit 1
        ;;
esac